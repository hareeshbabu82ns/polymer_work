<link rel="import"
      href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="todo-input.html"/>

<dom-module id="x-todo">
  <link rel="import" type="css" href="x-todo.css">
  <template>
    <parse-element id="todos" class_name="Todos" items="{{todos}}"></parse-element>
    <!-- To create a new Todo -->
    <paper-material id="newTodo" elevation="2">
      <iron-a11y-keys id="a11y" target="[[target]]" keys="enter"
                      on-keys-pressed="_addTodo"></iron-a11y-keys>
      <paper-input id="todoTitle" label="Todo Title" value="{{todo.title::input}}"></paper-input>
      <paper-fab icon="icons:add" on-tap="_addTodo" mini></paper-fab>
    </paper-material>
      <template is="dom-repeat" items="{{todos}}">
        <todo-item item="{{item}}"
                   on-todo-destroy-item="_destroyTodo"
                   on-todo-update-item="_updateTodo"></todo-item>
      </template>
  </template>
  <script>
    Polymer({
      is: "x-todo",
      properties: {
        todo: {
          type: Object,
          value: function () {
            return {title: "", finished: false};
          }
        },
        todos: {
          type: Array,
          value: function () {
            return [];
          }
        },
        target: {
          type: Object,
          value: function () {
            return this.$.todoTitle;
          }
        }
      },
      _addTodo: function () {
        var ltodo = _.clone(this.todo);
        this.set('todo.title', '')
        this.$.todos.addObject(ltodo, {
          success: function (obj) {
            console.log("object added");
          }
        });
      },
      _updateTodo: function (event) {
        console.log(event.detail);
        this.$.todos.updateObject(event.detail);
      }
      ,
      _destroyTodo: function (event) {
        console.log(event.detail);
        this.$.todos.deleteObject(event.detail);
      },
      _keyEvents: function () {
        console.log("key pressed" + args);
      }
    })
    ;
  </script>
</dom-module>